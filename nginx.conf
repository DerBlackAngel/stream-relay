worker_processes  1;
error_log  /var/log/nginx/rtmp-error.log debug;

events { worker_connections 1024; }

rtmp {
  server {
    listen 1935;
    chunk_size 4096;

    # Eing√§nge (getrennte Inputs)
    application dennis {
      live on;
      record off;
      wait_key on;
      meta copy;
      on_publish http://auth-server:3000/auth/dennis;
      allow publish all;
      allow play all;  # ffmpeg darf lesen
    }

    application auria {
      live on;
      record off;
      wait_key on;
      meta copy;
      on_publish http://auth-server:3000/auth/auria;
      allow publish all;
      allow play all;
    }

    application mobil {
      live on;
      record off;
      wait_key on;
      meta copy;
      on_publish http://auth-server:3000/auth/mobil;
      allow publish all;
      allow play all;
    }

    # Optionaler Pool
    application live {
      live on;
      record off;
      wait_key on;
      meta copy;
      allow publish all;
      allow play all;
    }
  }
}

http {
  server {
    listen 18080;

    location /stat {
      rtmp_stat all;
      rtmp_stat_stylesheet stat.xsl;
    }
    location /stat.xsl {
      root /usr/local/nginx/html;
    }
    location /health {
      default_type text/plain;
      return 200 "OK\n";
    }
  }
}
